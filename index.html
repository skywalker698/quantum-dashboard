<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f172a">
 <link rel="manifest" href="https://script.google.com/macros/s/AKfycbzrVLLUSjKiq7CDpX6H1EwYzXmo_hRiqRKMiextzxUidywAY_kfNXeyHUl8nDJG6KIyzw/exec?path=manifest.json">


  <title>Quantum Profit Advisor</title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: 'Prompt', sans-serif; background-color: #f8fafc; }
    .container { max-width: 1300px; margin-top: 40px; margin-bottom: 60px; }
    .chart-container, .table-container, .summary-cards { background: #fff; border-radius: 12px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 24px; margin-bottom: 24px; }
    footer { position: fixed; bottom: 0; width: 100%; background: #0f172a; color: #fff; text-align: center; padding: 10px; }
    .navbar { background-color: #0f172a; }
    .navbar-brand, .nav-link { color: #fff !important; }
    .card { border: none; text-align: center; }
    .card h5 { font-size: 18px; color: #6b7280; }
    .card h3 { font-size: 28px; color: #0f172a; font-weight: bold; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="#">üìä Quantum Dashboard</a>
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="#">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
      <li class="nav-item"><a class="nav-link" href="#">‡∏Å‡∏£‡∏≤‡∏ü</a></li>
      <li class="nav-item"><a class="nav-link" href="#">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a></li>
    </ul>
  </div>
</nav>

<!-- Content -->
<div class="container">

  <!-- Summary Cards -->
  <div class="row summary-cards text-center">
    <div class="col-md-4 mb-3">
      <div class="card p-3">
        <h5>üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</h5>
        <h3 id="totalRevenue">-</h3>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card p-3">
        <h5>üí∏ ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°</h5>
        <h3 id="totalProfit">-</h3>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card p-3">
        <h5>üìà ROI ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h5>
        <h3 id="avgRoi">-</h3>
      </div>
    </div>
  </div>

  <!-- Chart -->
  <div class="chart-container">
    <h2 class="text-center mb-4">üìä ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö ROI ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
    <canvas id="roiChart" height="120"></canvas>
  </div>

  <!-- Table -->
  <div class="table-container">
    <h2 class="text-center mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</h2>
    <table id="businessTable" class="table table-striped" style="width:100%">
      <thead class="table-dark">
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</th>
          <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
          <th>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡∏ö‡∏≤‡∏ó)</th>
          <th>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th>
          <th>‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)</th>
          <th>ROI (%)</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<!-- Footer -->
<footer>
  ‚öôÔ∏è Quantum Advisor | AI Dashboard with Google Sheet & PWA
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>

<script>
  const apiURL = "https://script.google.com/macros/s/AKfycbzrVLLUSjKiq7CDpX6H1EwYzXmo_hRiqRKMiextzxUidywAY_kfNXeyHUl8nDJG6KIyzw/exec";

  async function fetchData() {
    const res = await fetch(apiURL);
    const data = await res.json();

    // ===== Summary Data =====
    const totalRevenue = data.reduce((sum, item) => sum + parseFloat(item.revenue), 0);
    const totalProfit = data.reduce((sum, item) => sum + (parseFloat(item.revenue) - parseFloat(item.cost)), 0);
    const avgROI = (data.reduce((sum, item) => sum + parseFloat(item.roi), 0) / data.length).toFixed(2);

    document.getElementById("totalRevenue").textContent = totalRevenue.toLocaleString() + " ‡∏ø";
    document.getElementById("totalProfit").textContent = totalProfit.toLocaleString() + " ‡∏ø";
    document.getElementById("avgRoi").textContent = avgROI + " %";

    // ===== Chart =====
    const labels = data.map(item => item.activity);
    const roi = data.map(item => parseFloat(item.roi));

    const ctx = document.getElementById('roiChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'ROI (%)',
          data: roi,
          backgroundColor: '#3b82f6',
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // ===== Table =====
    const tbody = document.getElementById("tableBody");
    data.forEach(row => {
      const revenue = parseFloat(row.revenue);
      const cost = parseFloat(row.cost);
      const profit = revenue - cost;
      const roi = revenue ? ((profit / revenue) * 100).toFixed(2) : 0;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.activity}</td>
        <td>${row.type}</td>
        <td>${revenue.toLocaleString()}</td>
        <td>${cost.toLocaleString()}</td>
        <td>${profit.toLocaleString()}</td>
        <td>${roi}</td>
      `;
      tbody.appendChild(tr);
    });

    $('#businessTable').DataTable();
  }

  window.addEventListener('DOMContentLoaded', fetchData);

  // PWA Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register("https://script.google.com/macros/s/AKfycbzrVLLUSjKiq7CDpX6H1EwYzXmo_hRiqRKMiextzxUidywAY_kfNXeyHUl8nDJG6KIyzw/exec?path=service-worker.js")
      .then(() => console.log("‚úÖ Service Worker registered"))
      .catch(err => console.error("‚ùå Service Worker failed", err));
  }
</script>
</body>
</html>
